<div class="container">
  <button id="captureButton">Prendre une photo</button>
  <video autoplay id="video"></video>
  <canvas id="canvas"></canvas>
  <button id="captureImgButton">Prendre une photo</button>
</div>
<%= render "boardgames/partials/search" %>
<div class="container">
  <div class="cards">
    <% @boardgames.each do |boardgame| %>
      <%= render "shared/card", boardgame: boardgame %>
    <% end %>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const captureButton = document.getElementById("captureButton");
  const capturImgButton = document.getElementById("captureImgButton");

  const getImgKeyWords = () => {

  }

  captureButton.addEventListener("click", async function() {
    // Accéder à la caméra de l'utilisateur
    if ('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices) {
      // ok, browser supports it
    }

    const constraints = {
      video: {
        width: {
          min: 1280,
          ideal: 1920,
          max: 2560,
        },
        height: {
          min: 720,
          ideal: 1080,
          max: 1440,
        },
        facingMode: "environment"
      },
    }


    const video = document.querySelector('#video')
    const videoStream = await navigator.mediaDevices.getUserMedia(constraints)
    video.srcObject = videoStream


  });
    captureImgButton.addEventListener("click", async function() {
      const canvas = document.querySelector('#canvas')
      canvas.width = video.videoWidth
      canvas.height = video.videoHeight
      canvas.getContext('2d').drawImage(video, 0, 0)

      const img = document.createElement('img')
      img.src = canvas.toDataURL('image/png')
      console.log("Test")
      const buttonValidate = document.createElement('button')
      captureImgButton.appendChild(buttonValidate);
      buttonValidate.innerHTML = "Send it"
      captureImgButton.addEventListener("click", () => {
        console.log(img.src);
      })
    });
});
</script>
